From 8f5c97c0dfd958e669424f8df80b38f1e50d1138 Mon Sep 17 00:00:00 2001
From: Daniel Micay <danielmicay@gmail.com>
Date: Fri, 20 Oct 2017 21:20:50 -0400
Subject: [PATCH 17/19] mark non-secure origins as non-secure by default

---
 .../security_state/core/security_state.cc     | 19 +++++++++++--------
 1 file changed, 11 insertions(+), 8 deletions(-)

diff --git a/components/security_state/core/security_state.cc b/components/security_state/core/security_state.cc
index 6e825c52e231..82fa590afd5b 100644
--- a/components/security_state/core/security_state.cc
+++ b/components/security_state/core/security_state.cc
@@ -60,14 +60,17 @@ void SetSecurityLevelAndRelatedFieldsForNonSecureFieldTrial(
       return;
     }
 
-    // By default, if the feature is enabled, show a warning on all http://
-    // pages and mark as dangerous on form edits.
-    security_info->security_level =
-        input_events.insecure_field_edited ? DANGEROUS : HTTP_SHOW_WARNING;
-    // Do not set |field_edit_downgraded_security_level| here because that
-    // field is for specifically for when the security level was downgraded
-    // from NONE to HTTP_SHOW_WARNING, not from HTTP_SHOW_WARNING to DANGEROUS
-    // as in this case.
+    // Show a warning on all http:// pages and mark as dangerous on form edits.
+    if (parameter == features::kMarkHttpAsParameterWarningAndDangerousOnFormEdits) {
+        security_info->security_level =
+            input_events.insecure_field_edited ? DANGEROUS : HTTP_SHOW_WARNING;
+        // Do not set |field_edit_downgraded_security_level| here because that
+        // field is for specifically for when the security level was downgraded
+        // from NONE to HTTP_SHOW_WARNING, not from HTTP_SHOW_WARNING to DANGEROUS
+        // as in this case.
+    }
+
+    security_info->security_level = DANGEROUS;
     return;
   }
 
-- 
2.20.1

